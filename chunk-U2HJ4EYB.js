import{i,ka as u,l as c,x as l}from"./chunk-E4F463IZ.js";var p=class o{API_URL="https://mb-port-production.up.railway.app/api";isBrowser;constructor(e){this.isBrowser=u(e)}async checkSession(e,s){if(!this.isBrowser)return{success:!1,hasActiveSession:!1,message:"Not in browser"};try{return await(await fetch(`${this.API_URL}/check-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_email:e,project_name:s})})).json()}catch(t){return console.error("Failed to check session:",t),{success:!1,hasActiveSession:!1,message:"Session check failed"}}}async saveAccessRequest(e){if(!this.isBrowser)return!1;try{let s=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone,r=this.formatLocalTime(s,t);return(await(await fetch(`${this.API_URL}/access-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_name:e.visitor_name,visitor_email:e.visitor_email,project_name:e.project_name,project_type:e.project_type,redirect_url:e.redirect_url,otp_code:e.otp_code,local_time:r,client_timezone:t})})).json()).success}catch(s){return console.error("Failed to save access request:",s),!1}}formatLocalTime(e,s){let t=this.getTimezoneAbbreviation(s),r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0"),g=String(e.getSeconds()).padStart(2,"0");return`${r}-${n}-${a} ${m}:${d}:${g} ${t}`}getTimezoneAbbreviation(e){return{"Asia/Kolkata":"IST","Asia/Calcutta":"IST","America/New_York":"EST","America/Los_Angeles":"PST","America/Chicago":"CST","America/Denver":"MST","Europe/London":"GMT","Europe/Paris":"CET","Europe/Berlin":"CET","Asia/Tokyo":"JST","Asia/Shanghai":"CST","Asia/Dubai":"GST","Australia/Sydney":"AEST","Pacific/Auckland":"NZST"}[e]||e.split("/").pop()||"LOCAL"}async markAsVerified(e,s){if(!this.isBrowser)return!1;try{return(await(await fetch(`${this.API_URL}/access-requests/verify`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_email:e,otp_code:s})})).json()).success}catch(t){return console.error("Failed to update access request:",t),!1}}async getAllAccessRequests(){if(!this.isBrowser)return[];try{let s=await(await fetch(`${this.API_URL}/access-requests`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();return s.success?s.data:[]}catch(e){return console.error("Failed to get access requests:",e),[]}}async getStats(){if(!this.isBrowser)return null;try{let s=await(await fetch(`${this.API_URL}/stats`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();return s.success?s.data:null}catch(e){return console.error("Failed to get stats:",e),null}}async saveContactMessage(e){if(!this.isBrowser)return{success:!1,message:"Not in browser"};try{let s=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone,r=this.formatLocalTime(s,t);return await(await fetch(`${this.API_URL}/contact-messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sender_name:e.sender_name,sender_email:e.sender_email,subject:e.subject||"No Subject",message:e.message,local_time:r,client_timezone:t})})).json()}catch(s){return console.error("Failed to save contact message:",s),{success:!1,message:"Failed to save message"}}}async getAllContactMessages(){if(!this.isBrowser)return[];try{let s=await(await fetch(`${this.API_URL}/contact-messages`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();return s.success?s.data:[]}catch(e){return console.error("Failed to get contact messages:",e),[]}}async getUnreadCount(){if(!this.isBrowser)return 0;try{let s=await(await fetch(`${this.API_URL}/contact-messages/unread`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();return s.success?s.unread_count:0}catch(e){return console.error("Failed to get unread count:",e),0}}async getContactMessageStats(){if(!this.isBrowser)return null;try{let s=await(await fetch(`${this.API_URL}/contact-messages/stats`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();return s.success?s.data:null}catch(e){return console.error("Failed to get contact message stats:",e),null}}static \u0275fac=function(s){return new(s||o)(c(l))};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};export{p as a};
